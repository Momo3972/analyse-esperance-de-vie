---
title: "Analyse de l'espérance de vie"
author: "Lamine"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output:
  word_document:
    toc: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo    = TRUE,
  warning = FALSE,
  message = FALSE
)

library(readr)
library(dplyr)
library(naniar)
library(ggplot2)
library(corrplot)
library(MASS)
library(glmnet)
library(randomForest)
library(tidyr)
library(tibble)
library(broom)
```

# 1. Introduction
Ce rapport présente une analyse complète des facteurs influençant l'espérance de vie dans le monde à partir des données de l'Organisation Mondiale de la Santé (2000–2015).

Les grandes étapes incluent :

importation et nettoyage des données,

analyse exploratoire,

modélisation linéaire (simple, LASSO, stepwise),

modélisation non linéaire (Random Forest),

comparaison finale des modèles,

extraction des variables les plus explicatives.

# 2. Importation et nettoyage des données
Rédaction

df <- read_csv("data/Life Expectancy Data.csv")

Vérification structure initiale
Rédaction

head(df)
str(df)

Analyse des valeurs manquantes
Rédaction

miss_var_summary(df)
vis_miss(df)

Harmonisation des types
Rédaction

df <- df %>%
mutate(
Country = as.factor(Country),
Status = as.factor(Status),
Year = as.integer(Year)
)

Renommage propre
Rédaction

df <- df %>%
rename(
life_expectancy = Life expectancy,
adult_mortality = Adult Mortality,
infant_deaths = infant deaths,
alcohol = Alcohol,
percentage_expenditure = percentage expenditure,
hepatitis_b = Hepatitis B,
measles = Measles,
bmi = BMI,
under_five_deaths = under-five deaths,
polio = Polio,
total_expenditure = Total expenditure,
diphtheria = Diphtheria,
hiv_aids = HIV/AIDS,
gdp = GDP,
population = Population,
thinness_1_19 = thinness 1-19 years,
thinness_5_9 = thinness 5-9 years,
income_composition = Income composition of resources,
schooling = Schooling
)

names(df)

# 3. Analyse exploratoire
Statistiques descriptives
Rédaction

summary(df)

Corrélations entre variables numériques
Rédaction

df_numeric <- df %>% select(where(is.numeric))
cor_mat <- cor(df_numeric, use="pairwise.complete.obs")

corrplot(cor_mat, method="color", tl.cex=0.6)

Distribution de l'espérance de vie
Rédaction

ggplot(df, aes(life_expectancy)) +
geom_histogram(bins=30, fill="#4C72B0", color="white") +
labs(title="Distribution de l'espérance de vie")

Relation avec adult_mortality
Rédaction

ggplot(df, aes(adult_mortality, life_expectancy)) +
geom_point(alpha=0.5) +
labs(title="Espérance de vie vs Mortalité adulte")

Espérance de vie selon le statut du pays
Rédaction

ggplot(df, aes(Status, life_expectancy, fill=Status)) +
geom_boxplot() +
labs(title="Espérance de vie selon le statut du pays")

PIB vs Espérance de vie (log)
Rédaction

ggplot(df, aes(gdp, life_expectancy)) +
geom_point(alpha=0.5) +
scale_x_log10() +
labs(title="Espérance de vie vs PIB (échelle logarithmique)")

# 4. Nettoyage final
Suppression des NA sur la variable cible
Rédaction

df <- df %>% filter(!is.na(life_expectancy))

Imputation médiane pour les autres colonnes numériques
Rédaction

df <- df %>%
mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(., na.rm=TRUE), .)))

Vérification finale
Rédaction

sum(is.na(df))

# 5. Modélisation linéaire simple
Création train/test
Rédaction

set.seed(123)
n <- nrow(df)
train_idx <- sample(1, size = 0.8*n)

train <- df[train_idx, ]
test <- df[-train_idx, ]

Modèle linéaire
Rédaction

formule_lm <- life_expectancy ~ adult_mortality + gdp + schooling +
income_composition + hiv_aids + bmi + alcohol + Status + Year

modele_lm <- lm(formule_lm, data=train)
summary(modele_lm)

Évaluation
Rédaction

pred_train <- predict(modele_lm, newdata=train)
pred_test <- predict(modele_lm, newdata=test)

rmse <- function(y,yhat) sqrt(mean((y-yhat)^2))
r2 <- function(y,yhat) 1 - sum((y-yhat)^2) / sum((y-mean(y))^2)

rmse_train <- rmse(train$life_expectancy, pred_train)
rmse_test <- rmse(test$life_expectancy, pred_test)
r2_train <- r2(train$life_expectancy, pred_train)
r2_test <- r2(test$life_expectancy, pred_test)

# 6. Sélection de variables
Stepwise AIC
Rédaction

modele_full <- lm(formule_lm, data=train)
modele_step <- stepAIC(modele_full, direction="both", trace=FALSE)
summary(modele_step)

LASSO
Rédaction

X_train <- model.matrix(formule_lm, data=train)[,-1]
X_test <- model.matrix(formule_lm, data=test)[,-1]
y_train <- train$life_expectancy
y_test <- test$life_expectancy

set.seed(123)
cv_lasso <- cv.glmnet(X_train, y_train, alpha=1)
modele_lasso <- glmnet(X_train, y_train, alpha=1, lambda=cv_lasso$lambda.min)

# 7. Random Forest
Rédaction

train_rf <- train %>% select(-Country)
test_rf <- test %>% select(-Country)

modele_rf <- randomForest(
life_expectancy ~ .,
data=train_rf,
ntree=500,
mtry=4,
importance=TRUE
)

# 8. Comparaison finale
Rédaction

comparaison_finale <- tibble(
Model = c("Régression linéaire", "LASSO", "Stepwise", "Random Forest"),
RMSE_Train = c(rmse_train, rmse(y_train,predict(modele_lasso,X_train)), rmse(train$life_expectancy,predict(modele_step,train)), sqrt(mean((train_rf$life_expectancy-predict(modele_rf,train_rf))^2))),
RMSE_Test = c(rmse_test, rmse(y_test,predict(modele_lasso,X_test)), rmse(test$life_expectancy,predict(modele_step,test)), sqrt(mean((test_rf$life_expectancy-predict(modele_rf,test_rf))^2))),
R2_Train = c(r2_train, r2(y_train,predict(modele_lasso,X_train)), r2(train$life_expectancy,predict(modele_step,train)),
1 - sum((train_rf$life_expectancy-predict(modele_rf,train_rf))^2)/sum((train_rf$life_expectancy-mean(train_rf$life_expectancy))^2)),
R2_Test = c(r2_test, r2(y_test,predict(modele_lasso,X_test)), r2(test$life_expectancy,predict(modele_step,test)),
1 - sum((test_rf$life_expectancy-predict(modele_rf,test_rf))^2)/sum((test_rf$life_expectancy-mean(test_rf$life_expectancy))^2))
)

comparaison_finale

# 9. Importance des variables
Modèle linéaire (blindé sans caractères spéciaux)
Rédaction

coeffs <- as.data.frame(summary(modele_lm)$coefficients)
coeffs$Variable <- rownames(coeffs)
coeffs <- coeffs %>% filter(Variable != "(Intercept)")
coeffs$Importance <- abs(coeffs$Estimate)

top_lm <- coeffs %>% arrange(desc(Importance)) %>% head(10)
top_lm

Random Forest
Rédaction

imp_rf <- as.data.frame(importance(modele_rf))
imp_rf$Variable <- rownames(imp_rf)

top_rf <- imp_rf %>% arrange(desc(%IncMSE)) %>% head(10)
top_rf

# 10. Conclusion générale

L'espérance de vie est fortement influencée par :

- le niveau socio-économique (composition du revenu, éducation),

- les indicateurs de santé (mortalité adulte, VIH / SIDA),

- le statut de développement du pays.

Le modèle Random Forest offre la meilleure performance prédictive.

Les variables les plus importantes sont cohérentes entre les modèles.

Investir dans l'éducation, réduire la mortalité adulte et lutter contre le VIH sont des leviers majeurs pour augmenter l'espérance de vie.

# 11. Fin du document

Rapport généré automatiquement via RMarkdown.